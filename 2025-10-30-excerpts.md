## `src/graph/KnowledgeGraphManager.ts`
<KnowledgeGraphManager.ts-L7-L27>
```
export class KnowledgeGraphManager {
  public async loadGraph(): Promise<KnowledgeGraph> {
    return await loadGraphFile();
  }

  private async saveGraph(graph: KnowledgeGraph): Promise<void> {
    await saveGraphFile(graph);
  }

  // Initialize status and priority entities
  async initializeStatusAndPriority(): Promise<void> {
    const graph = await this.loadGraph();

    // Create status entities if they don't exist
    for (const statusValue of VALID_STATUS_VALUES) {
      const statusName = `status:${statusValue}`;
      if (!graph.entities.some(e => e.name === statusName && e.entityType === 'status')) {
        graph.entities.push({
          name: statusName,
          entityType: 'status',
          observations: [`A ${statusValue} status value`]
```
</KnowledgeGraphManager.ts-L7-L27>

<KnowledgeGraphManager.ts-L323-L344>
```
  async getProjectOverview(projectName: string): Promise<any> {
    const graph = await this.loadGraph();

    // Find the project
    const project = graph.entities.find(e => e.name === projectName && e.entityType === 'project');
    if (!project) {
      throw new Error(`Project '${projectName}' not found`);
    }

    // Extract project info from observations
    const description = project.observations.find(o => o.startsWith('Description:'))?.split(':', 2)[1]?.trim();
    const startDate = project.observations.find(o => o.startsWith('StartDate:'))?.split(':', 2)[1]?.trim();
    const endDate = project.observations.find(o => o.startsWith('EndDate:'))?.split(':', 2)[1]?.trim();
    const priority = project.observations.find(o => o.startsWith('Priority:'))?.split(':', 2)[1]?.trim();
    const status = project.observations.find(o => o.startsWith('Status:'))?.split(':', 2)[1]?.trim() || 'planning';
    const goal = project.observations.find(o => o.startsWith('Goal:'))?.split(':', 2)[1]?.trim();
    const budget = project.observations.find(o => o.startsWith('Budget:'))?.split(':', 2)[1]?.trim();

    // Find components of the project
    const components = graph.entities.filter(e => {
      return graph.relations.some(r =>
        r.from === e.name &&
```
</KnowledgeGraphManager.ts-L323-L344>

## ``wc -l src/graph/KnowledgeGraphManager.ts``
<shell-output>
```
1930 src/graph/KnowledgeGraphManager.ts
```
</shell-output>

## `src/mcp/tools/startsession.ts`
<startsession.ts-L45-L58>
```
          const status = await kgm.getEntityStatus(project.name);
          if (status === "active") {
            projects.push(project);
          }
        }

        // Get tasks
        const taskQuery = await kgm.searchNodes("entityType:task");
        const tasks = [];

        // Filter for high priority and active tasks
        for (const task of taskQuery.entities) {
          const status = await kgm.getEntityStatus(task.name);
          const priority = await kgm.getEntityPriority(task.name);
```
</startsession.ts-L45-L58>

## `src/graph/KnowledgeGraphManager.ts`
<KnowledgeGraphManager.ts-L49-L60>
```
    const graph = await this.loadGraph();

    // Find status relation for this entity
    const statusRelation = graph.relations.find(r =>
      r.from === entityName &&
      r.relationType === 'has_status'
    );

    if (statusRelation) {
      // Extract status value from the status entity name (status:value)
      return statusRelation.to.split(':')[1];
    }
```
</KnowledgeGraphManager.ts-L49-L60>

## `src/mcp/tools/endsession.ts`
<endsession.ts-L112-L125>
```
            const achievementEntities = await Promise.all(achievements.map(async (achievement: string, index: number) => {
              const achievementName = `achievement_${timestamp}_${index}`;
              await kgm.createEntities([
                {
                  name: achievementName,
                  entityType: 'decision',
                  observations: [achievement],
                  embedding: undefined
                }
              ]);

              await kgm.createRelations([
                {
                  from: achievementName,
                  to: project,
                  relationType: 'part_of',
                  observations: []
```
</endsession.ts-L112-L125>

<endsession.ts-L138-L148>
```
                } else if (taskUpdate.status === 'in_progress' || taskUpdate.status === 'ongoing' || taskUpdate.status === 'started') {
                  standardStatus = 'active';
                } else if (taskUpdate.status === 'not_started' || taskUpdate.status === 'planned' || taskUpdate.status === 'upcoming') {
                  standardStatus = 'inactive';
                }

                // Update the task status using the entity-relation approach
                await kgm.setEntityStatus(taskUpdate.name, standardStatus);

                // If the task is completed, link it to the current session
                if (standardStatus === 'completed') {
```
</endsession.ts-L138-L148>

## `src/storage/graphStore.ts`
<graphStore.ts-L6-L15>
```
  try {
    const fileContent = await fs.readFile(MEMORY_FILE_PATH, "utf-8");
    return JSON.parse(fileContent);
  } catch {
    return { entities: [], relations: [] };
  }
}

export async function saveGraph(graph: KnowledgeGraph): Promise<void> {
  await fs.writeFile(MEMORY_FILE_PATH, JSON.stringify(graph, null, 2), "utf-8");
```
</graphStore.ts-L6-L15>

## `src/utils/ids.ts`
<ids.ts-L1-L3>
```
export function generateSessionId(): string {
  return `proj_${Date.now()}_${Math.random().toString(36).substring(2, 15)}`;
}
```
</ids.ts-L1-L3>

## `src/mcp/tools/startsession.ts`
<startsession.ts-L154-L166>
```

  ## Session ID
  \`${sessionId}\`

  ## Recent Project Management Sessions
  ${sessionsText || "No recent sessions found."}

  ## Active Projects
  ${projectsText.join("\n") || "No active projects found."}

  ## High-Priority Tasks
  ${tasksText.join("\n") || "No high-priority tasks found."}

```
</startsession.ts-L154-L166>

## `index.ts`
<index.ts-L14-L19>
```
import { startServer } from "./src/server.js";
export { KnowledgeGraphManager } from "./src/graph/KnowledgeGraphManager.js";

startServer().catch(err => {
  console.error("Fatal error:", err);
  process.exit(1);
```
</index.ts-L14-L19>

## `src/server.ts`
<server.ts-L10-L21>
```
export async function startServer() {
  const kgm = new KnowledgeGraphManager();
  await kgm.initializeStatusAndPriority();

  const server = new McpServer({ name: "Context Manager", version: "1.0.0" });

  const __filename = fileURLToPath(import.meta.url);
  const __dirname = path.dirname(__filename);
  const descriptions = loadToolDescriptions(__dirname);

  registerAll(server, descriptions, kgm);
```
</server.ts-L10-L21>
